# Slack to OpenAI Gateway

This Ruby code packaged as a serverless AWS SAM app serves as a bridge between Slack and the OpenAI API, allowing a group of users to interact with GPT-4 via a shared Slack channel. This opens up exciting possibilities for collaborative conversations with AI in a group setting.

### Update

We have now implemented basic interaction with the OpenAI API. A separate GPT class has been created to process Slack conversation history into OpenAI chat message lists and to send the OpenAI API requests.

### Future Work

The next step is to integrate the OpenAI API so that the responses to Slack messages are generated by GPT-4. This will involve adding a new method to the `SlackEventsAPIHandler` class to make the API call, and modifying the `message` method to use this new method.

## Overview

The application is based on AWS Lambda and is triggered by events from the Slack Events API. This means that whenever a user posts a message in the linked Slack channel, an event is sent to our Lambda function, which processes the event and sends a response back to the Slack channel. The core processing logic is encapsulated in a Ruby class called `SlackEventsAPIHandler`.

```mermaid
graph TD
    A[Slack User] -- sends message --> B((Slack API))
    B -- triggers message event --> C{AWS Lambda\nin API Gateway}
    C -- posts message --> F((SQS Queue))
    C -- responds successfully\nimmediately --> B
    F -- triggers event --> G{AWS Lambda\non SQS event}
    G -- executes --> D[SlackEventsAPIHandler]
    D -- sends message event --> E{OpenAI API}
    E -- returns response --> D
    D -- sends chat message --> B
    B -- posts message --> A
```

The `SlackEventsAPIHandler` class is responsible for parsing incoming Slack events, dispatching them to the correct handler based on their type, and returning the appropriate response. Currently, it supports two types of events: `url_verification` and `message`.

The `url_verification` event is used by Slack to confirm that our endpoint is operational and owned by us. When this event type is received, the class simply echoes back the 'challenge' string provided in the event.

The `message` event type is triggered whenever a message is posted in the Slack channel. When this event type is received, the class logs the message text and sends a response back to the Slack channel. Currently, the response is simply a mirror of the original message, but the plan is to replace this with a call to the OpenAI API, so the response will be generated by GPT-4.

## Architecture

This project is a serverless application based on the AWS Serverless Application Model (SAM). It uses AWS Lambda for running the application code in response to events, such as a new message in the Slack channel.  It also uses AWS SQS to asynchronously decouple the event receiving and processing stages into two separate Lambda functions: One for API Gateway to call when the Slack API sends an event, and the other to process the event asynchronously.

## Configuration

The application is configured to run in different environments (e.g., development, production) using environment variables and parameters stored in AWS Systems Manager (SSM) Parameter Store. The parameters are fetched at runtime and include the Slack App ID and Access Token.

## Testing

The code includes a comprehensive suite of RSpec tests to ensure that it handles Slack events correctly. These tests cover the main event dispatching logic, as well as the individual handlers for the supported event types.

## Contribution

Contributions to this project are welcome! Feel free to fork the repository and submit a pull request with your changes. Before submitting your pull request, please ensure that your changes pass the test suite and that you have added tests for any new functionality. Also, please update the README if necessary to reflect your changes.

## Credits

Most of the code and the README were written by ChatGPT, an AI model developed by OpenAI. You can view the conversation that resulted in this README [here](https://chat.openai.com/share/294e63c7-3398-4dc6-a353-6435c23fcd6a).
